# AgentFlow ç»Ÿä¸€æµç¨‹æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£å®šä¹‰ AgentFlow çš„æ ¸å¿ƒä¸šåŠ¡æµç¨‹ï¼Œç¡®ä¿æ‰€æœ‰è¯­è¨€ç‰ˆæœ¬ï¼ˆPython/Go/Node.jsï¼‰è¡Œä¸ºä¸€è‡´ã€‚

---

## ğŸ¯ æ ¸å¿ƒæµç¨‹æ€»è§ˆ

```
1. ç³»ç»Ÿå¯åŠ¨æµç¨‹
2. ä»»åŠ¡åˆ›å»ºæµç¨‹
3. ä»»åŠ¡æ‰§è¡Œæµç¨‹
4. Git é›†æˆæµç¨‹
5. å†²çªè§£å†³æµç¨‹
6. Worker ç”Ÿå‘½å‘¨æœŸ
7. é”™è¯¯å¤„ç†æµç¨‹
8. å…³é—­ä¸æ¸…ç†æµç¨‹
```

---

## 1ï¸âƒ£ ç³»ç»Ÿå¯åŠ¨æµç¨‹

### Master å¯åŠ¨æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Master å¯åŠ¨                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. åŠ è½½é…ç½®
   â”œâ”€ è¯»å–é…ç½®æ–‡ä»¶ (master.config.yaml)
   â”œâ”€ åº”ç”¨ç¯å¢ƒå˜é‡è¦†ç›–
   â””â”€ éªŒè¯é…ç½®æœ‰æ•ˆæ€§

2. åˆå§‹åŒ–æ•°æ®åº“
   â”œâ”€ æ‰“å¼€/åˆ›å»ºæ•°æ®åº“æ–‡ä»¶
   â”œâ”€ æ‰§è¡Œ migrationsï¼ˆå¦‚éœ€è¦ï¼‰
   â”œâ”€ åˆå§‹åŒ–ç´¢å¼•å’Œè§†å›¾
   â””â”€ éªŒè¯æ•°æ®åº“å®Œæ•´æ€§

3. åˆå§‹åŒ–ç»„ä»¶
   â”œâ”€ åˆ›å»º HTTP æœåŠ¡å™¨
   â”œâ”€ è®¾ç½®è·¯ç”±å’Œä¸­é—´ä»¶
   â”œâ”€ åˆå§‹åŒ– WebSocket æœåŠ¡å™¨ï¼ˆå¦‚å¯ç”¨ï¼‰
   â”œâ”€ åˆ›å»ºäº‹ä»¶æ€»çº¿
   â””â”€ åˆå§‹åŒ– Git é›†æˆï¼ˆå¦‚å¯ç”¨ï¼‰

4. å¯åŠ¨åå°æœåŠ¡
   â”œâ”€ å¿ƒè·³æ¸…ç†çº¿ç¨‹ï¼ˆæ¯ 60 ç§’ï¼‰
   â”‚  â””â”€ æ¸…ç†è¶…æ—¶ Worker
   â”œâ”€ ç»Ÿè®¡ä¿¡æ¯æ”¶é›†ï¼ˆæ¯ 30 ç§’ï¼‰
   â””â”€ è‡ªåŠ¨å…³é—­ç›‘æ§ï¼ˆå¦‚å¯ç”¨ï¼‰

5. å¯åŠ¨æœ¬åœ° Workersï¼ˆå¦‚é…ç½®ï¼‰
   â”œâ”€ æ£€æµ‹ç³»ç»Ÿç±»å‹ï¼ˆdarwin/linux/windowsï¼‰
   â”œâ”€ ä¸ºæ¯ä¸ªç»„å¯åŠ¨ä¸€ä¸ª Worker
   â””â”€ Worker è¿›ç¨‹ç®¡ç†

6. å¼€å§‹ç›‘å¬
   â”œâ”€ ç»‘å®š HTTP ç«¯å£ (é»˜è®¤ 8848)
   â”œâ”€ ç»‘å®š WebSocket ç«¯å£ (é»˜è®¤ 8849)
   â””â”€ è¾“å‡ºå¯åŠ¨ä¿¡æ¯

â†’ Master Ready
```

### Worker å¯åŠ¨æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Worker å¯åŠ¨                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. åŠ è½½é…ç½®
   â”œâ”€ è¯»å–é…ç½®æ–‡ä»¶ (worker.config.yaml)
   â”œâ”€ åº”ç”¨ç¯å¢ƒå˜é‡è¦†ç›–
   â””â”€ éªŒè¯é…ç½®æœ‰æ•ˆæ€§

2. ç”Ÿæˆ Worker IDï¼ˆå¦‚æœªæŒ‡å®šï¼‰
   â”œâ”€ æ ¼å¼: worker-{hostname}-{pid}-{random}
   â””â”€ æˆ–ä½¿ç”¨ UUID

3. åˆå§‹åŒ–ç»„ä»¶
   â”œâ”€ HTTP å®¢æˆ·ç«¯ï¼ˆç”¨äº Master é€šä¿¡ï¼‰
   â”œâ”€ Claude æ‰§è¡Œå™¨ï¼ˆæ£€æµ‹å¯ç”¨æ€§ï¼‰
   â”œâ”€ Shell æ‰§è¡Œå™¨
   â””â”€ å·¥ä½œç©ºé—´ç®¡ç†å™¨

4. æ³¨å†Œåˆ° Master
   â”œâ”€ POST /api/v1/workers/register
   â”œâ”€ { worker_id, group_name, platform, capabilities }
   â””â”€ â†’ Worker registered

5. å¯åŠ¨å¿ƒè·³
   â”œâ”€ å®šæ—¶å™¨ï¼šæ¯ 30 ç§’
   â”œâ”€ POST /api/v1/workers/:id/heartbeat
   â””â”€ å¤±è´¥ 3 æ¬¡æ ‡è®°ä¸ºç¦»çº¿

6. è¿›å…¥ä»»åŠ¡å¾ªç¯
   â”œâ”€ æ ¹æ® mode å†³å®šè¡Œä¸º
   â”‚  â”œâ”€ auto: è‡ªåŠ¨æ‹‰å–å’Œæ‰§è¡Œä»»åŠ¡
   â”‚  â”œâ”€ manual: ç­‰å¾…æ‰‹åŠ¨åˆ†é…
   â”‚  â””â”€ oneshot: æ‰§è¡Œä¸€ä¸ªä»»åŠ¡åé€€å‡º
   â””â”€ å¼€å§‹ä»»åŠ¡æ‹‰å–

â†’ Worker Ready
```

---

## 2ï¸âƒ£ ä»»åŠ¡åˆ›å»ºæµç¨‹

### API ä»»åŠ¡åˆ›å»º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä»»åŠ¡åˆ›å»º (API)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Client                           Master
  â”‚                                â”‚
  â”œâ”€ POST /api/v1/tasks â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚  {                              â”‚
  â”‚    title: "å®ç°ç”¨æˆ·ç™»å½•",        â”‚
  â”‚    description: "...",          â”‚
  â”‚    group_name: "frontend",      â”‚
  â”‚    priority: "high"             â”‚
  â”‚  }                              â”‚
  â”‚                                â”‚
  â”‚                                â”œâ”€ 1. éªŒè¯è¾“å…¥
  â”‚                                â”‚  â”œâ”€ å¿…å¡«å­—æ®µæ£€æŸ¥
  â”‚                                â”‚  â””â”€ å­—æ®µç±»å‹éªŒè¯
  â”‚                                â”‚
  â”‚                                â”œâ”€ 2. ç”Ÿæˆä»»åŠ¡ ID
  â”‚                                â”‚  â””â”€ TASK-XXXXXXXX
  â”‚                                â”‚
  â”‚                                â”œâ”€ 3. åˆ›å»ºå·¥ä½œç©ºé—´ï¼ˆå¦‚éœ€è¦ï¼‰
  â”‚                                â”‚  â””â”€ .agentflow/workspace/TASK-XXX/
  â”‚                                â”‚
  â”‚                                â”œâ”€ 4. æ’å…¥æ•°æ®åº“
  â”‚                                â”‚  INSERT INTO tasks (...)
  â”‚                                â”‚
  â”‚                                â”œâ”€ 5. å¹¿æ’­äº‹ä»¶
  â”‚                                â”‚  event: 'task.created'
  â”‚                                â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€ 201 Created â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  {                              â”‚
  â”‚    task_id: "TASK-XXX",         â”‚
  â”‚    status: "pending",           â”‚
  â”‚    created_at: "2026-01-22..."  â”‚
  â”‚  }                              â”‚
  â”‚                                â”‚
â†’ Task Created                     â”‚
```

### çˆ¶å­ä»»åŠ¡åˆ›å»º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 çˆ¶å­ä»»åŠ¡åˆ›å»º                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. åˆ›å»ºçˆ¶ä»»åŠ¡
   POST /api/v1/tasks
   { title: "å¼€å‘ç”¨æˆ·ç®¡ç†åŠŸèƒ½" }
   â†’ TASK-001 (status: pending)

2. åˆ†è§£ä¸ºå­ä»»åŠ¡
   POST /api/v1/tasks
   {
     parent_id: "TASK-001",
     title: "å®ç°ç™»å½• API",
     description: "..."
   }
   â†’ TASK-002 (parent_id: TASK-001)

   POST /api/v1/tasks
   {
     parent_id: "TASK-001",
     title: "å®ç°æ³¨å†Œ API",
     description: "..."
   }
   â†’ TASK-003 (parent_id: TASK-001)

3. ä»»åŠ¡æ ‘ç»“æ„
   TASK-001 (çˆ¶ä»»åŠ¡)
   â”œâ”€ TASK-002 (å­ä»»åŠ¡)
   â””â”€ TASK-003 (å­ä»»åŠ¡)

4. æ‰§è¡Œé€»è¾‘
   - å­ä»»åŠ¡å¯ä»¥ç‹¬ç«‹æ‰§è¡Œ
   - çˆ¶ä»»åŠ¡ç­‰å¾…æ‰€æœ‰å­ä»»åŠ¡å®Œæˆ
   - çˆ¶ä»»åŠ¡çŠ¶æ€ = f(å­ä»»åŠ¡çŠ¶æ€)
```

---

## 3ï¸âƒ£ ä»»åŠ¡æ‰§è¡Œæµç¨‹

### æ ‡å‡†ä»»åŠ¡æ‰§è¡Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä»»åŠ¡æ‰§è¡Œæµç¨‹                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Worker                           Master                    Database
  â”‚                                â”‚                           â”‚
  â”œâ”€ 1. æ‹‰å–å¾…æ‰§è¡Œä»»åŠ¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚
  â”‚  GET /api/v1/tasks/pending?   â”‚                           â”‚
  â”‚      group=frontend           â”‚                           â”‚
  â”‚                                â”‚                           â”‚
  â”‚                                â”œâ”€ æŸ¥è¯¢æ•°æ®åº“ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                                â”‚ SELECT * FROM tasks       â”‚
  â”‚                                â”‚ WHERE status='pending'    â”‚
  â”‚                                â”‚ AND group_name='frontend'â”‚
  â”‚                                â”‚                           â”‚
  â”‚                                â”‚<â”€ è¿”å›ä»»åŠ¡åˆ—è¡¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                â”‚                           â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€ è¿”å›ä»»åŠ¡åˆ—è¡¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
  â”‚  [TASK-001, TASK-002, ...]    â”‚                           â”‚
  â”‚                                â”‚                           â”‚
  â”œâ”€ 2. é€‰æ‹©ä»»åŠ¡                   â”‚                           â”‚
  â”‚  (æŒ‰ä¼˜å…ˆçº§æ’åº)                â”‚                           â”‚
  â”‚  â†’ TASK-001                    â”‚                           â”‚
  â”‚                                â”‚                           â”‚
  â”œâ”€ 3. å°è¯•é”å®šä»»åŠ¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚
  â”‚  POST /api/v1/tasks/TASK-001/ â”‚                           â”‚
  â”‚       lock                     â”‚                           â”‚
  â”‚  { worker_id: "worker-1" }     â”‚                           â”‚
  â”‚                                â”‚                           â”‚
  â”‚                                â”œâ”€ UPDATE tasks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                                â”‚ SET status='running',     â”‚
  â”‚                                â”‚ lock_holder='worker-1',   â”‚
  â”‚                                â”‚ lock_time=NOW()           â”‚
  â”‚                                â”‚ WHERE id='TASK-001'       â”‚
  â”‚                                â”‚                           â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€ é”å®šæˆåŠŸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
  â”‚  { status: "locked" }          â”‚                           â”‚
  â”‚                                â”‚                           â”‚
  â”œâ”€ 4. æ‰§è¡Œä»»åŠ¡                   â”‚                           â”‚
  â”‚  â”œâ”€ å°è¯•ä¼˜å…ˆçº§ 1: HTTP Executorâ”‚                           â”‚
  â”‚  â”‚  â”œâ”€ æ£€æŸ¥ Claude Server      â”‚                           â”‚
  â”‚  â”‚  â”œâ”€ å¦‚å¯ç”¨ï¼Œå‘é€è¯·æ±‚        â”‚                           â”‚
  â”‚  â”‚  â””â”€ â†’ æˆåŠŸåˆ™è·³è¿‡åç»­        â”‚                           â”‚
  â”‚  â”‚                             â”‚                           â”‚
  â”‚  â”œâ”€ å°è¯•ä¼˜å…ˆçº§ 2: Claude CLI   â”‚                           â”‚
  â”‚  â”‚  â”œâ”€ æ£€æŸ¥ claude å‘½ä»¤        â”‚                           â”‚
  â”‚  â”‚  â”œâ”€ æ‰§è¡Œ claude prompt      â”‚                           â”‚
  â”‚  â”‚  â””â”€ â†’ æˆåŠŸåˆ™è·³è¿‡åç»­        â”‚                           â”‚
  â”‚  â”‚                             â”‚                           â”‚
  â”‚  â””â”€ å°è¯•ä¼˜å…ˆçº§ 3: Shell Commandâ”‚                           â”‚
  â”‚     â”œâ”€ è§£æå‘½ä»¤å‰ç¼€            â”‚                           â”‚
  â”‚     â”‚  â”œâ”€ "shell:" â†’ ç›´æ¥æ‰§è¡Œ  â”‚                           â”‚
  â”‚     â”‚  â””â”€ æ— å‰ç¼€ â†’ Shell è§£é‡Š  â”‚                           â”‚
  â”‚     â”œâ”€ æ‰§è¡Œå‘½ä»¤                â”‚                           â”‚
  â”‚     â””â”€ æ•è·è¾“å‡º                â”‚                           â”‚
  â”‚                                â”‚                           â”‚
  â”œâ”€ 5. ä¸ŠæŠ¥è¿›åº¦ï¼ˆå¯é€‰ï¼‰           â”‚                           â”‚
  â”‚  POST /api/v1/tasks/TASK-001/ â”‚                           â”‚
  â”‚       progress                 â”‚                           â”‚
  â”‚  { progress: 50,               â”‚                           â”‚
  â”‚    message: "Processing..." }  â”‚                           â”‚
  â”‚                                â”‚                           â”‚
  â”‚                                â”œâ”€ å¹¿æ’­è¿›åº¦äº‹ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                                â”‚ event: 'task.progress'    â”‚
  â”‚                                â”‚                           â”‚
  â”œâ”€ 6. å®Œæˆä»»åŠ¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚
  â”‚  POST /api/v1/tasks/TASK-001/ â”‚                           â”‚
  â”‚       complete                 â”‚                           â”‚
  â”‚  { worker_id: "worker-1",      â”‚                           â”‚
  â”‚    result: "..." }             â”‚                           â”‚
  â”‚                                â”‚                           â”‚
  â”‚                                â”œâ”€ UPDATE tasks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                                â”‚ SET status='completed',   â”‚
  â”‚                                â”‚ result='...',             â”‚
  â”‚                                â”‚ completed_at=NOW()        â”‚
  â”‚                                â”‚ lock_holder=NULL         â”‚
  â”‚                                â”‚                           â”‚
  â”‚                                â”œâ”€ å¹¿æ’­å®Œæˆäº‹ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                                â”‚ event: 'task.completed'   â”‚
  â”‚                                â”‚                           â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
  â”‚                                â”‚                           â”‚
â†’ Task Completed                   â”‚                           â”‚
```

### æ‰§è¡Œå™¨ä¼˜å…ˆçº§æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ä¸‰çº§æ‰§è¡Œå™¨é€‰æ‹©æµç¨‹                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

function executeTask(task):
    result = null
    error = null

    # ä¼˜å…ˆçº§ 1: HTTP Executor (Claude Server)
    if httpExecutor.isAvailable():
        try:
            result = httpExecutor.execute(task)
            if result.success:
                return result
        except Exception as e:
            error = e
            log.warn("HTTP Executor failed:", e)

    # ä¼˜å…ˆçº§ 2: Claude CLI Executor
    if claudeExecutor.isEnabled():
        try:
            result = claudeExecutor.execute(task)
            if result.success:
                return result
        except Exception as e:
            error = e
            log.warn("Claude CLI failed:", e)

    # ä¼˜å…ˆçº§ 3: Shell Command Executor
    try:
        result = shellExecutor.execute(task)
        return result
    except Exception as e:
        log.error("All executors failed")
        raise TaskExecutionError("All executors failed", error)

# å‘½ä»¤è§£æè§„åˆ™
function parseCommand(description):
    if description.startsWith("shell:"):
        # æ˜¾å¼ shell å‘½ä»¤
        cmd = description.substring(6)
        return { type: "shell", command: cmd }

    elif description.startsWith("http:"):
        # æ˜¾å¼ HTTP è¯·æ±‚
        url = description.substring(5)
        return { type: "http", url: url }

    elif description.startsWith("claude:"):
        # æ˜¾å¼ Claude CLI
        prompt = description.substring(7)
        return { type: "claude", prompt: prompt }

    else:
        # è‡ªåŠ¨æ£€æµ‹
        if containsCodeBlocks(description):
            return { type: "claude", prompt: description }
        else:
            return { type: "shell", command: description }
```

---

## 4ï¸âƒ£ Git é›†æˆæµç¨‹

### Agent ä»»åŠ¡ä¸ Git åˆ†æ”¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Git é›†æˆä»»åŠ¡æ‰§è¡Œæµç¨‹                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. åˆ›å»º Git ä»»åŠ¡
   â”œâ”€ POST /api/v1/git/tasks
   â”‚  {
   â”‚    title: "å®ç°ç”¨æˆ·è®¤è¯",
   â”‚    agent_id: "agent-frontend",
   â”‚    file_boundaries: [...]
   â”‚  }
   â”œâ†’ GitTask {
        id: "GT-001",
        git_branch: "agent-agent-frontend/task-GT-001"
      }

2. åˆ›å»º Git åˆ†æ”¯
   â”œâ”€ git checkout -b agent-agent-frontend/task-GT-001
   â”œâ†’ åˆ†æ”¯åˆ›å»ºæˆåŠŸ

3. éªŒè¯æ–‡ä»¶è®¿é—®æƒé™
   â”œâ”€ è¯»å– .agentflow/boundaries.json
   â”œâ”€ æŸ¥æ‰¾ agent-frontend çš„è¾¹ç•Œè§„åˆ™
   â”œâ”€ æ£€æŸ¥è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦åœ¨å…è®¸èŒƒå›´å†…
   â”‚  â”œâ”€ access_type = "exclusive" â†’ åªæœ‰è¯¥ agent å¯è®¿é—®
   â”‚  â”œâ”€ access_type = "shared" â†’ å¤šä¸ª agent å¯è®¿é—®ï¼ˆéœ€é”ï¼‰
   â”‚  â””â”€ access_type = "readonly" â†’ åªè¯»è®¿é—®
   â””â†’ Allowed / Denied

4. è·å–æ–‡ä»¶é”ï¼ˆå¦‚éœ€è¦ï¼‰
   â”œâ”€ æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²é”å®š
   â”‚  SELECT * FROM git_locks
   â”‚  WHERE file_path=? AND status='active'
   â”œâ”€ å¦‚æœªé”å®šï¼Œåˆ›å»ºé”
   â”‚  INSERT INTO git_locks (...)
   â””â†’ Lock acquired / Conflict

5. Agent åœ¨åˆ†æ”¯ä¸Šå·¥ä½œ
   â”œâ”€ ä¿®æ”¹æ–‡ä»¶
   â”œâ”€ git add .
   â”œâ”€ git commit -m "agent-frontend: ..."
   â””â†’ æäº¤åœ¨ç‹¬ç«‹åˆ†æ”¯

6. å°è¯•åˆå¹¶åˆ°ä¸»åˆ†æ”¯
   â”œâ”€ git checkout main
   â”œâ”€ git merge --squash agent-agent-frontend/task-GT-001
   â”œâ”€ æ£€æµ‹å†²çª
   â”‚  â”œâ”€ æ— å†²çª â†’ åˆå¹¶æˆåŠŸ
   â”‚  â””â”€ æœ‰å†²çª â†’ è§¦å‘å‡çº§æœºåˆ¶
   â””â†’ Success / Conflict
```

### å†²çªè§£å†³æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ä¸‰çº§å†²çªè§£å†³æµç¨‹                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ£€æµ‹åˆ°å†²çª
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çº§åˆ« 1: è‡ªåŠ¨é‡è¯•   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç­‰å¾… 2 ç§’        â”‚
â”‚ â€¢ é‡æ–°å°è¯•åˆå¹¶     â”‚
â”‚ â€¢ æœ€å¤š 3 æ¬¡       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€ æˆåŠŸ â†’ ä»»åŠ¡å®Œæˆ âœ…
          â”‚
          â””â”€ ä»ç„¶å¤±è´¥
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çº§åˆ« 2: å‡çº§ä»»åŠ¡   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ åˆ›å»ºæ–°ä»»åŠ¡       â”‚
â”‚   UPGRADE-{id}    â”‚
â”‚ â€¢ æ›´é«˜ä¼˜å…ˆçº§       â”‚
â”‚ â€¢ åŒ…å«å†²çªä¿¡æ¯     â”‚
â”‚ â€¢ è‡ªåŠ¨è§£å†³å°è¯•     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€ å¯è‡ªåŠ¨è§£å†³
          â”‚  â””â”€ åˆ†æå†²çª
          â”‚     â”œâ”€ ä¿®æ”¹ä¸é‡å  â†’ è‡ªåŠ¨åˆå¹¶
          â”‚     â””â”€ åˆå¹¶æˆåŠŸ â†’ ä»»åŠ¡å®Œæˆ âœ…
          â”‚
          â””â”€ éœ€è¦äººå·¥è§£å†³
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çº§åˆ« 3: äººå·¥ä»‹å…¥   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æ ‡è®°çŠ¶æ€ä¸º       â”‚
â”‚   "manual"        â”‚
â”‚ â€¢ é€šçŸ¥ç›¸å…³äººå‘˜     â”‚
â”‚ â€¢ ç­‰å¾…äººå·¥è§£å†³     â”‚
â”‚ â€¢ éªŒè¯è§£å†³ç»“æœ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â””â”€ äººå·¥è§£å†³å®Œæˆ â†’ ä»»åŠ¡å®Œæˆ âœ…
```

---

## 5ï¸âƒ£ Worker ç”Ÿå‘½å‘¨æœŸ

### Worker æ³¨å†Œä¸å¿ƒè·³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Worker ç”Ÿå‘½å‘¨æœŸ                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. å¯åŠ¨
   â”œâ”€ ç”Ÿæˆ/åŠ è½½ Worker ID
   â”œâ”€ æ£€æµ‹ç³»ç»Ÿå¹³å°å’Œç»„
   â””â”€ åˆå§‹åŒ–æ‰§è¡Œå™¨

2. æ³¨å†Œåˆ° Master
   â”œâ”€ POST /api/v1/workers/register
   â”‚  {
   â”‚    worker_id: "worker-1",
   â”‚    group_name: "darwin",
   â”‚    platform: "darwin",
   â”‚    capabilities: ["claude", "gui", "cross-platform"]
   â”‚  }
   â”œâ†’ Worker registered
   â””â†’ INSERT INTO workers (...)

3. å¿ƒè·³å¾ªç¯
   â”œâ”€ æ¯ 30 ç§’å‘é€å¿ƒè·³
   â”‚  POST /api/v1/workers/worker-1/heartbeat
   â”œâ†’ UPDATE workers SET last_heartbeat=NOW()
   â”œâ”€ è¿ç»­å¤±è´¥ 3 æ¬¡ â†’ æ ‡è®°ä¸ºç¦»çº¿
   â””â†’ é‡æ–°å°è¯•è¿æ¥

4. ä»»åŠ¡æ‰§è¡Œå¾ªç¯
   â”œâ”€ GET /api/v1/tasks/pending?group=darwin
   â”œâ”€ å¦‚æœ‰ä»»åŠ¡
   â”‚  â”œâ”€ POST /api/v1/tasks/:id/lock
   â”‚  â”œâ”€ æ‰§è¡Œä»»åŠ¡
   â”‚  â”œâ”€ POST /api/v1/tasks/:id/complete
   â”‚  â””â”€ ç»§ç»­æ‹‰å–
   â””â”€ å¦‚æ— ä»»åŠ¡
      â””â”€ ç­‰å¾… 5 ç§’åé‡è¯•

5. æ­£å¸¸å…³é—­
   â”œâ”€ æ”¶åˆ°å…³é—­ä¿¡å·
   â”‚  â”œâ”€ å®Œæˆå½“å‰ä»»åŠ¡
   â”‚  â”œâ”€ å–æ¶ˆä»»åŠ¡é”å®š
   â”‚  â””â”€ é€šçŸ¥ Master
   â””â†’ Worker offline

6. å¼‚å¸¸å…³é—­
   â”œâ”€ è¿›ç¨‹å´©æºƒ
   â”œâ”€ Master æ£€æµ‹åˆ°å¿ƒè·³è¶…æ—¶ï¼ˆ120 ç§’ï¼‰
   â””â†’ UPDATE workers SET status='inactive'
```

---

## 6ï¸âƒ£ é”™è¯¯å¤„ç†æµç¨‹

### ä»»åŠ¡æ‰§è¡Œå¤±è´¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ä»»åŠ¡å¤±è´¥å¤„ç†                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. æ£€æµ‹å¤±è´¥
   â”œâ”€ æ‰§è¡Œå™¨æŠ›å‡ºå¼‚å¸¸
   â”œâ”€ è¶…æ—¶ï¼ˆé»˜è®¤ 600 ç§’ï¼‰
   â””â”€ å†…å­˜è¶…é™

2. è®°å½•é”™è¯¯
   â”œâ”€ INSERT INTO task_logs
   â”‚  (task_id, worker_id, log_level='error', message)
   â””â†’ Error logged

3. æ›´æ–°ä»»åŠ¡çŠ¶æ€
   â”œâ”€ POST /api/v1/tasks/:id/fail
   â”‚  { worker_id, error }
   â”œâ†’ UPDATE tasks
   â”‚  SET status='failed',
   â”‚      error='...',
   â”‚      completed_at=NOW()
   â””â†’ Task failed

4. é”™è¯¯å¤„ç†ç­–ç•¥
   â”œâ”€ å¦‚æœ retry_on_failure=true
   â”‚  â””â”€ é‡ç½®ä¸º pendingï¼Œå…è®¸é‡è¯•
   â”œâ”€ å¦‚æœè¶…è¿‡ max_retries
   â”‚  â””â”€ ä¿æŒ failed çŠ¶æ€
   â””â”€ å‘é€å¤±è´¥äº‹ä»¶
      event: 'task.failed'

5. ä¾èµ–ä»»åŠ¡å¤„ç†
   â”œâ”€ å¦‚æœæœ‰å­ä»»åŠ¡
   â”‚  â””â”€ å–æ¶ˆæ‰€æœ‰ pending å­ä»»åŠ¡
   â””â”€ å¦‚æœæ˜¯å­ä»»åŠ¡
      â””â”€ é€šçŸ¥çˆ¶ä»»åŠ¡
```

### Master é”™è¯¯å¤„ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Master é”™è¯¯å¤„ç†                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. æ•°æ®åº“è¿æ¥å¤±è´¥
   â”œâ”€ é‡è¯•è¿æ¥ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
   â”œâ”€ å¦‚ä»å¤±è´¥
   â”‚  â””â”€ FATAL: æ— æ³•å¯åŠ¨ Master
   â””â†’ é€€å‡ºå¹¶è®°å½•é”™è¯¯

2. HTTP æœåŠ¡å™¨å¯åŠ¨å¤±è´¥
   â”œâ”€ æ£€æŸ¥ç«¯å£å ç”¨
   â”œâ”€ å°è¯•å…¶ä»–ç«¯å£
   â””â”€ å¦‚å…¨éƒ¨å¤±è´¥ â†’ FATAL

3. Worker å¿ƒè·³è¶…æ—¶
   â”œâ”€ æ ‡è®° Worker ä¸ºç¦»çº¿
   â”œâ”€ é‡Šæ”¾è¯¥ Worker çš„ä»»åŠ¡é”
   â”‚  UPDATE tasks
   â”‚  SET lock_holder=NULL
   â”‚  WHERE lock_holder=?
   â””â†’ ä»»åŠ¡å¯è¢«å…¶ä»– Worker æ‰§è¡Œ

4. å†…å­˜ä¸è¶³
   â”œâ”€ è®°å½•è­¦å‘Š
   â”œâ”€ æ‹’ç»æ–°ä»»åŠ¡
   â””â”€ ç­‰å¾…èµ„æºé‡Šæ”¾
```

---

## 7ï¸âƒ£ å…³é—­ä¸æ¸…ç†æµç¨‹

### ä¼˜é›…å…³é—­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ä¼˜é›…å…³é—­æµç¨‹                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Master å…³é—­:
    â”‚
    â”œâ”€ 1. åœæ­¢æ¥å—æ–°ä»»åŠ¡
    â”‚  â””â”€ POST /api/v1/tasks è¿”å› 503
    â”‚
    â”œâ”€ 2. ç­‰å¾…è¿è¡Œä¸­çš„ä»»åŠ¡å®Œæˆ
    â”‚  â”œâ”€ æ£€æŸ¥ status='running' çš„ä»»åŠ¡
    â”‚  â””â”€ æœ€å¤šç­‰å¾… 300 ç§’
    â”‚
    â”œâ”€ 3. é€šçŸ¥æ‰€æœ‰ Workers
    â”‚  â”œâ”€ WebSocket broadcast: shutdown event
    â”‚  â””â”€ Workers ä¼˜é›…é€€å‡º
    â”‚
    â”œâ”€ 4. åœæ­¢åå°æœåŠ¡
    â”‚  â”œâ”€ å¿ƒè·³æ¸…ç†çº¿ç¨‹
    â”‚  â”œâ”€ ç»Ÿè®¡æ”¶é›†çº¿ç¨‹
    â”‚  â””â”€ äº‹ä»¶ç›‘å¬å™¨
    â”‚
    â”œâ”€ 5. å…³é—­æ•°æ®åº“è¿æ¥
    â”‚  â””â”€ db.close()
    â”‚
    â””â”€ 6. é€€å‡º
       â””â†’ exit(0)

Worker å…³é—­:
    â”‚
    â”œâ”€ 1. å®Œæˆå½“å‰ä»»åŠ¡
    â”‚  â”œâ”€ ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆ
    â”‚  â””â”€ ä¸ŠæŠ¥ç»“æœ
    â”‚
    â”œâ”€ 2. é‡Šæ”¾ä»»åŠ¡é”
    â”‚  â””â”€ POST /api/v1/tasks/:id/unlock
    â”‚
    â”œâ”€ 3. é€šçŸ¥ Master
    â”‚  â””â”€ æœ€åä¸€æ¬¡å¿ƒè·³
    â”‚
    â””â”€ 4. é€€å‡º
       â””â†’ exit(0)
```

### å¼ºåˆ¶å…³é—­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¼ºåˆ¶å…³é—­ï¼ˆSIGKILLï¼‰                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. æ¥æ”¶åˆ° SIGKILL ä¿¡å·
    â”‚
    â”œâ”€ æ— æ³•ä¼˜é›…å…³é—­
    â”‚  â””â”€ è¿›ç¨‹ç«‹å³ç»ˆæ­¢
    â”‚
    â”œâ”€ æ•°æ®åº“çŠ¶æ€
    â”‚  â”œâ”€ ä»»åŠ¡é”ä¿æŒï¼ˆlock_holder ä»è®¾ç½®ï¼‰
    â”‚  â””â”€ ä¸‹æ¬¡å¯åŠ¨æ—¶æ¸…ç†
    â”‚
    â””â†’ è‡ªåŠ¨æ¸…ç†æœºåˆ¶
        â”œâ”€ Master é‡å¯æ—¶
        â”‚  â””â”€ æ¸…ç†è¶…æ—¶çš„ä»»åŠ¡é”
        â””â”€ Worker é‡è¿æ—¶
           â””â”€ æ£€æµ‹å¹¶é‡Šæ”¾æ—§é”
```

---

## 8ï¸âƒ£ å®Œæ•´ç¤ºä¾‹ï¼šç«¯åˆ°ç«¯ä»»åŠ¡æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å®Œæ•´ä»»åŠ¡æ‰§è¡Œç¤ºä¾‹ï¼ˆæ—¶é—´çº¿ï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T0: å®¢æˆ·ç«¯åˆ›å»ºä»»åŠ¡
    POST /api/v1/tasks
    { title: "é‡æ„ç”¨æˆ·æ¨¡å—", group_name: "frontend" }
    â†’ TASK-001 created

T1: Worker-1 æ‹‰å–ä»»åŠ¡
    GET /api/v1/tasks/pending?group=frontend
    â†’ [TASK-001]

T2: Worker-1 é”å®šä»»åŠ¡
    POST /api/v1/tasks/TASK-001/lock
    { worker_id: "worker-1" }
    â†’ locked

T3: Worker-1 å°è¯• HTTP Executor
    â†’ Claude Server ä¸å¯ç”¨ï¼Œè·³è¿‡

T4: Worker-1 å°è¯• Claude CLI
    $ claude "é‡æ„ç”¨æˆ·æ¨¡å—..."
    â†’ æ‰§è¡Œä¸­...

T5: Worker-1 ä¸ŠæŠ¥è¿›åº¦
    POST /api/v1/tasks/TASK-001/progress
    { progress: 30, message: "æ­£åœ¨åˆ†æä»£ç ..." }
    â†’ progress updated

T6: Worker-1 ä¸ŠæŠ¥è¿›åº¦
    POST /api/v1/tasks/TASK-001/progress
    { progress: 60, message: "æ­£åœ¨é‡æ„..." }
    â†’ progress updated

T7: Worker-1 å®Œæˆä»»åŠ¡
    POST /api/v1/tasks/TASK-001/complete
    { worker_id: "worker-1", result: "é‡æ„å®Œæˆï¼Œä¿®æ”¹äº† 5 ä¸ªæ–‡ä»¶" }
    â†’ completed

T8: Master å¹¿æ’­äº‹ä»¶
    WebSocket: { type: 'task.completed', data: {...} }
    â†’ æ‰€æœ‰ç›‘å¬è€…æ”¶åˆ°é€šçŸ¥

â†’ ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç»“æŸ
```

---

## ğŸ¯ æµç¨‹å›¾ç¬¦å·è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  å¼€å§‹/ç»“æŸ
â”‚  Start  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  å¤„ç†æ­¥éª¤
â”‚ Process â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  åˆ¤æ–­
â”‚ Decision â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”€â”€â†’     é¡ºåºæµç¨‹
    â”€â”¼â†’     å¹¶è¡Œæµç¨‹
   <--->    åŒå‘é€šä¿¡
```

---

**ç‰ˆæœ¬**: v1.0.0
**æ›´æ–°**: 2026-01-22
**ä½œè€…**: AgentFlow Team
**ç›¸å…³æ–‡æ¡£**: [ç»Ÿä¸€æ¶æ„è®¾è®¡](./unified-architecture.md)
