version: '3.8'

services:
  cpds-master:
    build:
      context: ../..
      dockerfile: deployments/docker/Dockerfile
    container_name: cpds-master-standalone
    restart: "no"  # Exit after completion in standalone mode
    ports:
      - "8848:8848"
    environment:
      - CPDS_MODE=standalone
      - CPDS_MASTER_AUTO_SHUTDOWN=true
    volumes:
      - ./data/standalone:/app/.claude/cpds-manager
    command: ["master", "--mode", "standalone", "--auto-shutdown", "--host", "0.0.0.0"]
    networks:
      - cpds-standalone

  cpds-worker:
    build:
      context: ../..
      dockerfile: deployments/docker/Dockerfile
    depends_on:
      - cpds-master
    environment:
      - CPDS_MODE=standalone
    volumes:
      - ./data/standalone:/app/.claude/cpds-manager
    command: ["worker", "--mode", "standalone", "--master", "http://cpds-master:8848", "--oneshot"]
    networks:
      - cpds-standalone

networks:
  cpds-standalone:
    driver: bridge
